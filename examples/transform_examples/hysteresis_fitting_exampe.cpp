#include "../../modules/transform/distance_potential_minimization.hpp"
#include <iostream>
#include <chrono>

//#define MEASURE


int main()
{

    blaze::DynamicVector<double> x = { 131, 130, 145, 264, 309, 285, 303, 175, 152, 299, 252, 148, 155, 152, 274, 167,
        266, 143, 300, 203, 259, 208, 224, 289, 172, 141, 147, 207, 165, 267, 295, 128, 275, 249, 125, 130, 260, 278,
        225, 256, 147, 149, 145, 205, 149, 292, 157, 149, 307, 151, 264, 298, 137, 156, 307, 209, 226, 157, 144, 129,
        146, 212, 213, 306, 300, 200, 217, 300, 134, 266, 273, 142, 137, 280, 204, 173, 257, 297, 139, 286, 212, 166,
        301, 281, 134, 288, 278, 206, 290, 263, 167, 276, 211, 165, 135, 149, 303, 239, 133, 128, 321, 152, 18, 99, 297,
        214, 297, 46, 331, 87, 314, 296, 343, 81, 441, 61, 157, 479, 133, 313, 191, 251, 71, 298, 107, 454, 160, 468,
        106, 365, 184, 153, 161, 471, 491, 485, 387, 180, 128, 100, 385, 46, 245, 26, 170, 290, 84, 477, 23, 122, 368,
        131, 438, 473, 74, 371, 246, 420, 491, 390, 84, 359, 108, 100, 208, 407, 461, 339, 5, 251, 380, 476, 39, 88,
        326, 202, 397, 158, 408, 60, 189, 33, 59, 167, 466, 4, 340, 464, 173, 196, 342, 26, 145, 226, 152, 103, 421,
        148, 364, 82 };
    blaze::DynamicVector<double> y = { 203, 155, 244, 323, 235, 159, 280, 304, 288, 305, 322, 277, 284, 122, 139, 299,
        319, 148, 224, 107, 327, 329, 325, 310, 101, 232, 258, 321, 309, 316, 169, 171, 306, 121, 194, 206, 327, 322,
        332, 335, 260, 123, 270, 333, 271, 181, 113, 282, 265, 107, 333, 205, 207, 268, 213, 325, 332, 108, 243, 232,
        140, 335, 328, 278, 196, 106, 329, 252, 192, 148, 146, 246, 234, 154, 112, 104, 136, 179, 164, 171, 328, 119,
        203, 169, 234, 314, 309, 103, 200, 148, 123, 163, 328, 288, 152, 146, 248, 116, 174, 170, 202, 85, 136, 76, 294,
        371, 265, 104, 378, 174, 299, 81, 48, 7, 20, 102, 317, 344, 303, 238, 20, 224, 130, 27, 130, 373, 87, 334, 87,
        139, 89, 85, 136, 256, 162, 85, 53, 378, 22, 95, 38, 271, 14, 209, 362, 81, 371, 92, 230, 126, 141, 243, 48,
        382, 305, 29, 172, 304, 231, 106, 56, 292, 366, 345, 379, 171, 247, 174, 10, 102, 215, 277, 255, 312, 113, 131,
        355, 146, 160, 323, 105, 11, 243, 246, 53, 100, 138, 367, 133, 5, 2, 10, 280, 90, 147, 5, 54, 97, 266, 89 };

    auto t1 = std::chrono::steady_clock::now();
    auto result = metric::fit_hysteresis(x, y, 400, 500);
    //auto result = metric::fit_hysteresis(x, y, 500, 600);
    auto t2 = std::chrono::steady_clock::now();

    std::cout << " xc " << result[0] << " yc= " << result[1] << " a " << result[2] << " b= " << result[3]
              << " phi= " << result[4] << std::endl;
    std::cout << " (Time = " << double(std::chrono::duration_cast<std::chrono::microseconds>(t2 - t1).count()) / 1000000
              << " s)" << std::endl;

    return 0;
}
